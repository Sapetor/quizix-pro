<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="/">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

    <!-- Preload critical CSS -->
    <link rel="preload" href="css/main.bundle.css?v=11.4" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="css/main.bundle.css?v=11.4"></noscript>
    
    <!-- Preload critical JavaScript -->
    <link rel="preload" href="js/main.js" as="script" crossorigin="anonymous">
    <link rel="preload" href="js/core/app.js" as="script" crossorigin="anonymous">
    <link rel="preload" href="js/utils/translation-manager.js" as="script" crossorigin="anonymous">
    
    <!-- Optimized font loading for mobile performance -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Fallback fonts while Inter loads */
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; }
    </style>
    <style>
        /* Critical FOUC prevention styles - must be inline to load immediately */
        :root {
            /* Critical theme variables for immediate application */
            --critical-bg: #0a0a0a;
            --critical-text: #ffffff;
        }
        
        [data-theme="light"] {
            --critical-bg: #f8fafc;
            --critical-text: #1a202c;
        }
        
        [data-theme="dark"] {
            --critical-bg: #0a0a0a;
            --critical-text: #ffffff;
        }
        
        html { 
            background: var(--critical-bg);
            color: var(--critical-text);
        }
        
        body { 
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--critical-bg);
            color: var(--critical-text);
            opacity: 0;
            transition: opacity 0.3s ease-in;
        }
        
        body.loaded { 
            opacity: 1; 
        }
        
        /* Prevent Inter font loading shift - exclude MathJax elements */
        *:not(mjx-container):not(mjx-container *):not(.MathJax):not(.MathJax *) { 
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        }
        
        /* Mobile LaTeX FOUC Prevention */
        .latex-content, .math-content, .has-math {
            min-height: 1.2em;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        /* Show LaTeX content when MathJax is ready */
        body.mathjax-ready .latex-content,
        body.mathjax-ready .math-content,
        body.mathjax-ready .has-math {
            opacity: 1;
        }
        
        /* Mobile-specific LaTeX loading indicator */
        @media (max-width: 768px) {
            .latex-content:not(.rendered)::after,
            .math-content:not(.rendered)::after {
                content: "â³";
                opacity: 0.6;
                font-size: 0.8em;
                animation: pulse 1.5s infinite;
            }
            
            @keyframes pulse {
                0%, 100% { opacity: 0.3; }
                50% { opacity: 0.8; }
            }
        }
    </style>
    <!-- CSS loaded via preload above for better performance -->
    <!-- CDN MathJax with fallback for WSL/Windows environment -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
            onerror="console.warn('MathJax CDN failed, app will function without LaTeX rendering')"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- SheetJS for Excel file processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Chart.js for results analytics visualizations - Fixed for ES6 compatibility -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <!-- Highlight.js for One Dark Pro syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        // FOUC Prevention: Set font scale and theme immediately from localStorage
        (function() {
            
            const savedFontSize = localStorage.getItem('globalFontSize') || 'medium';
            const scaleValues = { small: 0.9, medium: 1.0, large: 1.3, xlarge: 1.6 };
            document.documentElement.style.setProperty('--global-font-scale', scaleValues[savedFontSize]);
            
            // Get theme from unified quizSettings storage
            let initialTheme = 'light'; // default
            const savedQuizSettings = localStorage.getItem('quizSettings');
            if (savedQuizSettings) {
                try {
                    const settings = JSON.parse(savedQuizSettings);
                    initialTheme = settings.theme || 'light';
                } catch (e) {
                    // Fallback to old storage format if parsing fails
                    initialTheme = localStorage.getItem('theme') || 'light';
                }
            } else {
                // Fallback to old storage format if quizSettings doesn't exist
                initialTheme = localStorage.getItem('theme') || 'light';
            }
            
            // Apply theme immediately to prevent color shift
            document.documentElement.setAttribute('data-theme', initialTheme);
            
            // Set theme and update icons when DOM is ready
            document.addEventListener('DOMContentLoaded', () => {
                if (document.body) {
                    document.body.setAttribute('data-theme', initialTheme);
                    // Ensure both html and body have the same theme for consistent CSS matching
                    document.documentElement.setAttribute('data-theme', initialTheme);
                }
                
                
                // Initialize theme toggles (desktop and mobile)
                const themeToggleButtons = [
                    document.getElementById('theme-toggle'),
                    document.getElementById('theme-toggle-mobile-header')
                ].filter(button => button !== null);
                
                const fontIcon = document.getElementById('font-size-icon');
                
                themeToggleButtons.forEach(button => {
                    const iconSpan = button.querySelector('.control-icon');
                    const emoji = initialTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
                    
                    if (iconSpan) {
                        iconSpan.textContent = emoji;
                    } else {
                        button.textContent = emoji;
                    }
                });
                
                if (fontIcon) {
                    const icons = { small: 'Aâ»', medium: 'A', large: 'Aâº', xlarge: 'Aâºâº' };
                    fontIcon.textContent = icons[savedFontSize] || 'A';
                }
            });
        })();
        
        // Fallback theme toggle function for immediate use
        window.toggleTheme = function() {
            const body = document.body;
            if (!body) return; // Safety check
            
            // Get all theme toggle buttons (desktop and mobile)
            const themeToggleButtons = [
                document.getElementById('theme-toggle'),
                document.getElementById('theme-toggle-mobile-header')
            ].filter(button => button !== null);
            
            const currentTheme = body.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            // Set theme on both html and body for consistent CSS matching
            body.setAttribute('data-theme', newTheme);
            document.documentElement.setAttribute('data-theme', newTheme);
            
            // Update all theme toggle buttons
            themeToggleButtons.forEach(button => {
                const iconSpan = button.querySelector('.control-icon');
                const newEmoji = newTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
                
                if (iconSpan) {
                    iconSpan.textContent = newEmoji;
                } else {
                    button.textContent = newEmoji;
                }
            });
            
            localStorage.setItem('theme', newTheme);
        };
        
        // Fallback font size toggle
        window.toggleGlobalFontSize = function() {
            const scales = ['small', 'medium', 'large', 'xlarge'];
            const currentScale = localStorage.getItem('globalFontSize') || 'medium';
            const currentIndex = scales.indexOf(currentScale);
            const nextIndex = (currentIndex + 1) % scales.length;
            const newScale = scales[nextIndex];
            
            const scaleValues = { small: 0.9, medium: 1.0, large: 1.3, xlarge: 1.6 };
            document.documentElement.style.setProperty('--global-font-scale', scaleValues[newScale]);
            localStorage.setItem('globalFontSize', newScale);
            
            const fontIcon = document.getElementById('font-size-icon');
            if (fontIcon) {
                const icons = { small: 'Aâ»', medium: 'A', large: 'Aâº', xlarge: 'Aâºâº' };
                fontIcon.textContent = icons[newScale] || 'A';
            }
        };
        
        // REMOVED: F5 prevention was causing infinite reload loop
        
        // Function to mark MathJax as ready for our application
        function markMathJaxReady() {
            window.mathJaxReady = true;
            
            // FOUC Prevention: Add ready class and remove loading
            const addReadyClass = () => {
                if (document.body) {
                    document.body.classList.remove('loading');
                    document.body.classList.add('mathjax-ready');
                }
            };
            
            if (document.body) {
                addReadyClass();
            } else {
                document.addEventListener('DOMContentLoaded', addReadyClass);
            }
            
            // Dispatch custom event for SimpleMathJaxService
            document.dispatchEvent(new CustomEvent('mathjax-ready'));
        }
        
        // MathJax configuration object
        const mathJaxConfig = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                packages: {'[+]': ['ams', 'newcommand', 'configmacros']},
                processEscapes: true,
                processEnvironments: true,
                tags: 'none',
                autoload: {
                    color: [],
                    colorv2: ['color']
                }
            },
            chtml: {
                scale: window.innerWidth <= 768 ? 0.9 : 1, // Smaller scale on mobile for better fit
                minScale: 0.5,
                matchFontHeight: false,
                displayAlign: 'center',
                displayIndent: '0em',
                fontURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2',
                // Mobile optimizations
                adaptiveCSS: true,
                mathmlSpacing: false,
                exFactor: window.innerWidth <= 768 ? 0.45 : 0.5 // Tighter spacing on mobile
            },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    // Faster ready signal on mobile, slower on desktop for stability
                    const readyDelay = window.innerWidth <= 768 ? 50 : 100;
                    setTimeout(markMathJaxReady, readyDelay);
                }
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                includeHtmlTags: {br: '\n', wbr: '', '#comment': ''},
                processHtmlClass: 'tex2jax_process',
                ignoreHtmlClass: 'tex2jax_ignore',
                renderActions: {
                    addMenu: [0, '', '']
                }
            },
            loader: {
                load: ['[tex]/ams', '[tex]/newcommand', '[tex]/configmacros']
            }
        };
        
        // Handle cached MathJax - smart reload for reliability while preserving mobile cache benefits
        if (window.MathJax) {
            // Clear cached MathJax and reload fresh
            delete window.MathJax;
            window.mathJaxReady = false;
            
            // Remove existing script
            const existingScript = document.getElementById('MathJax-script');
            if (existingScript) existingScript.remove();
            
            // Wait for DOM to be fully ready before reloading MathJax
            const reloadMathJax = () => {
                // Ensure there's a stylesheet for MathJax to insert CSS rules into
                if (!document.querySelector('style[id*="MathJax"]')) {
                    const mathJaxStyle = document.createElement('style');
                    mathJaxStyle.id = 'MathJax-styles';
                    mathJaxStyle.textContent = '/* MathJax CSS insertion point */';
                    document.head.appendChild(mathJaxStyle);
                }
                
                const newScript = document.createElement('script');
                newScript.id = 'MathJax-script';
                newScript.async = true;
                // Use version-based cache busting instead of timestamp for better mobile caching
                const version = '3.2.2'; // MathJax version for cache busting
                const sessionId = sessionStorage.getItem('mathJaxSessionId') || Date.now().toString();
                sessionStorage.setItem('mathJaxSessionId', sessionId);
                newScript.src = `https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js?v=${version}&sid=${sessionId}`;
                
                window.MathJax = mathJaxConfig;
                document.head.appendChild(newScript);
            };
            
            // Ensure DOM and stylesheets are ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', reloadMathJax);
            } else {
                // DOM is ready, but wait a moment for stylesheets
                setTimeout(reloadMathJax, 100);
            }
            
        } else {
            // Fresh MathJax initialization
            window.MathJax = mathJaxConfig;
        }
        
        // Fallback: Ensure content is visible even if MathJax fails
        setTimeout(() => {
            if (!document.body.classList.contains('mathjax-ready')) {
                document.body.classList.add('mathjax-ready');
            }
        }, 3000);
    </script>
    
    
    <style>
        /* FOUC Prevention Styles */
        .mathjax-loading {
            visibility: hidden !important;
        }
        
        /* Hide LaTeX source until rendered */
        .tex2jax_process {
            visibility: hidden;
        }
        
        /* Smooth reveal after MathJax ready */
        .mathjax-ready .tex2jax_process,
        .mathjax-ready .mathjax-loading {
            visibility: visible;
            transition: opacity 0.2s ease-in;
        }
        
        /* Elegant background flash prevention - use theme-aware colors */
        html {
            background: var(--critical-bg) !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <!-- Desktop Title -->
            <h1 class="desktop-title" data-translate="app_title">Quizix Pro</h1>
            
            <!-- Mobile Title with Welcome -->
            <div class="mobile-title mobile-only">
                <div class="mobile-title-content">
                    <span class="welcome-text" data-translate="welcome_to">Welcome to</span>
                    <h1 data-translate="app_title">Quizix Pro</h1>
                </div>
                
                <!-- Mobile Controls in Header -->
                <div class="mobile-header-controls">
                    <!-- Return to Main Button (only visible when not on main menu) -->
                    <button id="mobile-return-to-main" class="mobile-control-btn mobile-header return-to-main-btn mobile-only" onclick="returnToMainFromHeader()" data-title-translate="return_to_main" style="display: none;">
                        <span class="control-icon">ğŸ </span>
                        <span class="control-label" data-translate="return_to_main">Return to Main Menu</span>
                    </button>
                    
                    <!-- Language Selector -->
                    <div class="language-selector mobile-lang mobile-header">
                        <div id="mobile-language-selector-header" class="language-dropdown mobile" data-onclick="toggleLanguageDropdown">
                            <div class="language-dropdown-selected">
                                <span class="language-flag">ğŸ‡ªğŸ‡¸</span>
                                <span class="language-name" data-translate="language_es">EspaÃ±ol</span>
                            </div>
                            <div class="language-dropdown-arrow">â–¼</div>
                            <div class="language-dropdown-options" id="mobile-language-options-header">
                                <div class="language-option" data-value="es" onclick="selectLanguage('es', event)">
                                    <span class="language-flag">ğŸ‡ªğŸ‡¸</span>
                                    <span class="language-name" data-translate="language_es">EspaÃ±ol</span>
                                </div>
                                <div class="language-option" data-value="en" onclick="selectLanguage('en', event)">
                                    <span class="language-flag">ğŸ‡ºğŸ‡¸</span>
                                    <span class="language-name" data-translate="language_en">English</span>
                                </div>
                                <div class="language-option" data-value="fr" onclick="selectLanguage('fr', event)">
                                    <span class="language-flag">ğŸ‡«ğŸ‡·</span>
                                    <span class="language-name" data-translate="language_fr">FranÃ§ais</span>
                                </div>
                                <div class="language-option" data-value="de" onclick="selectLanguage('de', event)">
                                    <span class="language-flag">ğŸ‡©ğŸ‡ª</span>
                                    <span class="language-name" data-translate="language_de">Deutsch</span>
                                </div>
                                <div class="language-option" data-value="it" onclick="selectLanguage('it', event)">
                                    <span class="language-flag">ğŸ‡®ğŸ‡¹</span>
                                    <span class="language-name" data-translate="language_it">Italiano</span>
                                </div>
                                <div class="language-option" data-value="pt" onclick="selectLanguage('pt', event)">
                                    <span class="language-flag">ğŸ‡µğŸ‡¹</span>
                                    <span class="language-name" data-translate="language_pt">PortuguÃªs</span>
                                </div>
                                <div class="language-option" data-value="pl" onclick="selectLanguage('pl', event)">
                                    <span class="language-flag">ğŸ‡µğŸ‡±</span>
                                    <span class="language-name" data-translate="language_pl">Polski</span>
                                </div>
                                <div class="language-option" data-value="ja" onclick="selectLanguage('ja', event)">
                                    <span class="language-flag">ğŸ‡¯ğŸ‡µ</span>
                                    <span class="language-name" data-translate="language_ja">æ—¥æœ¬èª</span>
                                </div>
                                <div class="language-option" data-value="zh" onclick="selectLanguage('zh', event)">
                                    <span class="language-flag">ğŸ‡¨ğŸ‡³</span>
                                    <span class="language-name" data-translate="language_zh">ä¸­æ–‡</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Theme Toggle -->
                    <button id="theme-toggle-mobile-header" class="mobile-control-btn mobile-header" data-title-translate="toggle_dark_mode_tooltip">
                        <span class="control-icon">â˜€ï¸</span>
                        <span class="control-label" data-translate="theme">theme</span>
                    </button>

                    <!-- Sound Toggle -->
                    <button id="sound-toggle-mobile-header" class="mobile-control-btn mobile-header" data-title-translate="toggle_sound_tooltip">
                        <span class="control-icon">ğŸ”Š</span>
                        <span class="control-label" data-translate="sound">sound</span>
                    </button>
                </div>
            </div>
            
            <div class="header-controls">
                <!-- Desktop Language Selector (hidden on mobile) -->
                <div class="language-selector">
                    <div id="language-selector" class="language-dropdown" data-onclick="toggleLanguageDropdown">
                        <div class="language-dropdown-selected">
                            <span class="language-flag">ğŸ‡ªğŸ‡¸</span>
                            <span class="language-name" data-translate="language_es">EspaÃ±ol</span>
                        </div>
                        <div class="language-dropdown-arrow">â–¼</div>
                        <div class="language-dropdown-options" id="language-options">
                            <div class="language-option" data-value="es" onclick="selectLanguage('es', event)">
                                <span class="language-flag">ğŸ‡ªğŸ‡¸</span>
                                <span class="language-name" data-translate="language_es">EspaÃ±ol</span>
                            </div>
                            <div class="language-option" data-value="en" onclick="selectLanguage('en', event)">
                                <span class="language-flag">ğŸ‡ºğŸ‡¸</span>
                                <span class="language-name" data-translate="language_en">English</span>
                            </div>
                            <div class="language-option" data-value="fr" onclick="selectLanguage('fr', event)">
                                <span class="language-flag">ğŸ‡«ğŸ‡·</span>
                                <span class="language-name" data-translate="language_fr">FranÃ§ais</span>
                            </div>
                            <div class="language-option" data-value="de" onclick="selectLanguage('de', event)">
                                <span class="language-flag">ğŸ‡©ğŸ‡ª</span>
                                <span class="language-name" data-translate="language_de">Deutsch</span>
                            </div>
                            <div class="language-option" data-value="it" onclick="selectLanguage('it', event)">
                                <span class="language-flag">ğŸ‡®ğŸ‡¹</span>
                                <span class="language-name" data-translate="language_it">Italiano</span>
                            </div>
                            <div class="language-option" data-value="pt" onclick="selectLanguage('pt', event)">
                                <span class="language-flag">ğŸ‡µğŸ‡¹</span>
                                <span class="language-name" data-translate="language_pt">PortuguÃªs</span>
                            </div>
                            <div class="language-option" data-value="pl" onclick="selectLanguage('pl', event)">
                                <span class="language-flag">ğŸ‡µğŸ‡±</span>
                                <span class="language-name" data-translate="language_pl">Polski</span>
                            </div>
                            <div class="language-option" data-value="ja" onclick="selectLanguage('ja', event)">
                                <span class="language-flag">ğŸ‡¯ğŸ‡µ</span>
                                <span class="language-name" data-translate="language_ja">æ—¥æœ¬èª</span>
                            </div>
                            <div class="language-option" data-value="zh" onclick="selectLanguage('zh', event)">
                                <span class="language-flag">ğŸ‡¨ğŸ‡³</span>
                                <span class="language-name" data-translate="language_zh">ä¸­æ–‡</span>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="start-hosting-header-small" class="btn primary small start-game-header" style="display: none;" data-translate-title="start_quiz_tooltip"><span data-translate="create_lobby">Create Lobby</span></button>
                
                <!-- Horizontal Toolbar (shown only in host editing mode) -->
                <div class="horizontal-toolbar" id="horizontal-toolbar" style="display: none;">
                    <div class="toolbar-group">
                        <button class="toolbar-btn" id="toolbar-add-question" data-translate-title="add_question_tooltip">
                            <span class="toolbar-icon">â•</span>
                        </button>
                        <button class="toolbar-btn" id="toolbar-save" data-translate-title="save_quiz_tooltip">
                            <span class="toolbar-icon">ğŸ’¾</span>
                        </button>
                        <button class="toolbar-btn" id="toolbar-load" data-translate-title="load_quiz_tooltip">
                            <span class="toolbar-icon">ğŸ“‚</span>
                        </button>
                    </div>
                    
                    <div class="toolbar-group">
                        <button class="toolbar-btn" id="toolbar-ai-gen" data-translate-title="ai_generator_tooltip">
                            <span class="toolbar-icon">ğŸ¤–</span>
                        </button>
                        <button class="toolbar-btn" id="toolbar-preview" data-translate-title="toggle_preview_tooltip">
                            <span class="toolbar-icon">ğŸ‘ï¸</span>
                        </button>
                        <button class="toolbar-btn" id="toolbar-import" data-translate-title="import_quiz_tooltip">
                            <span class="toolbar-icon">ğŸ“¥</span>
                        </button>
                        <button class="toolbar-btn" id="toolbar-export" data-translate-title="export_quiz_tooltip">
                            <span class="toolbar-icon">ğŸ“¤</span>
                        </button>
                        <button class="toolbar-btn" id="toolbar-results" data-translate-title="view_results_tooltip">
                            <span class="toolbar-icon">ğŸ“Š</span>
                        </button>
                    </div>
                    
                    <div class="toolbar-group">
                        <button class="toolbar-btn" id="toolbar-top" data-translate-title="back_to_top_tooltip">
                            <span class="toolbar-icon">â¬†ï¸</span>
                        </button>
                        <button class="toolbar-btn" id="toolbar-bottom" data-translate-title="go_to_bottom_tooltip">
                            <span class="toolbar-icon">â¬‡ï¸</span>
                        </button>
                    </div>
                </div>
                
                <!-- Desktop Theme and Controls (hidden on mobile) -->
                <!-- Global Font Size Control (hidden on mobile) -->
                <div class="font-size-control">
                    <button id="font-size-toggle" class="theme-toggle" data-translate-title="adjust_font_size_tooltip" onclick="toggleGlobalFontSize();">
                        <span id="font-size-icon">A</span>
                    </button>
                </div>
                
                <button id="desktop-return-to-main" class="theme-toggle desktop-only" data-translate-title="return_to_main" onclick="returnToMainFromHeader()" style="display: none;">
                    <span class="control-icon">ğŸ </span>
                </button>
                <button id="fullscreen-toggle" class="theme-toggle" data-translate-title="toggle_fullscreen_tooltip">â›¶</button>
                <button id="theme-toggle" class="theme-toggle" data-translate-title="toggle_dark_mode_tooltip">â˜€ï¸</button>
                <button id="sound-toggle" class="sound-toggle" data-translate-title="toggle_sound_tooltip">ğŸ”Š</button>
            </div>
        </header>

        <div id="main-menu" class="screen active">
            <!-- Original Desktop Menu Options (hidden on mobile) -->
            <div class="menu-options desktop-menu">
                <button id="host-btn" class="btn primary" data-translate="host_game">Host a Game</button>
                <button id="join-btn" class="btn secondary" data-translate="join_game">Join Game</button>
            </div>
            
            <!-- Original Desktop User Manual (hidden on mobile) -->
            <div class="user-manual desktop-menu">
                <h3 data-translate="quick_start_guide">ğŸ“š Quick Start Guide</h3>
                
                <div class="manual-sections">
                    <div class="manual-section">
                        <h4 data-translate="host_steps_title">ğŸ¯ To Host a Quiz:</h4>
                        <ol class="manual-steps">
                            <li data-translate="host_step_1">Click 'Host a Game'</li>
                            <li data-translate="host_step_2">Create questions or use AI Generator</li>
                            <li data-translate="host_step_3">Share the Game PIN with players</li>
                            <li data-translate="host_step_4">Start the game when ready</li>
                        </ol>
                    </div>
                    
                    <div class="manual-section">
                        <h4 data-translate="join_steps_title">ğŸ® To Join a Quiz:</h4>
                        <ol class="manual-steps">
                            <li data-translate="join_step_1">Click 'Join Game'</li>
                            <li data-translate="join_step_2">Enter the 6-digit Game PIN or scan QR code</li>
                            <li data-translate="join_step_3">Enter your name and join game</li>
                            <li data-translate="join_step_4">Or browse and select from open lobbies</li>
                        </ol>
                    </div>
                    
                    <div class="manual-section features">
                        <h4 data-translate="features_title">âœ¨ Key Features:</h4>
                        <div class="features-grid">
                            <span class="feature-item">ğŸ¤– <span data-translate="feature_ai">AI question generation</span></span>
                            <span class="feature-item">âš¡ <span data-translate="feature_realtime">Real-time multiplayer</span></span>
                            <span class="feature-item">ğŸ“ <span data-translate="feature_math">LaTeX math support</span></span>
                            <span class="feature-item">ğŸ–¼ï¸ <span data-translate="feature_images">Image questions</span></span>
                            <span class="feature-item">ğŸŒ <span data-translate="feature_multilang">Multi-language support</span></span>
                            <span class="feature-item">ğŸ“ <span data-translate="feature_types">Multiple question types</span></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile-Only Swipeable Quick Start Guide (Airbnb-style) -->
            <div class="quick-start-carousel mobile-only">
                <h3 data-translate="quick_start_guide">ğŸ“š Quick Start Guide</h3>
                
                <div class="carousel-container">
                    <div class="carousel-track">
                        <!-- Slide 1: Join a Game (now first) -->
                        <div class="carousel-slide active" data-slide="0">
                            <div class="slide-visual">
                                <div class="slide-icon">ğŸ®</div>
                                <div class="slide-bg-pattern join-pattern"></div>
                            </div>
                            <div class="slide-content">
                                <h4 data-translate="join_steps_title">To Join a Quiz:</h4>
                                <ol class="slide-steps">
                                    <li data-translate="join_step_1">Click 'Join Game'</li>
                                    <li data-translate="join_step_2">Enter the 6-digit Game PIN or scan QR code</li>
                                    <li data-translate="join_step_3">Enter your name and join game</li>
                                    <li data-translate="join_step_4">Or browse and select from open lobbies</li>
                                </ol>
                            </div>
                        </div>
                        
                        <!-- Slide 2: Host a Game (now second) -->
                        <div class="carousel-slide" data-slide="1">
                            <div class="slide-visual">
                                <div class="slide-icon">ğŸ¯</div>
                                <div class="slide-bg-pattern host-pattern"></div>
                            </div>
                            <div class="slide-content">
                                <h4 data-translate="host_steps_title">To Host a Quiz:</h4>
                                <ol class="slide-steps">
                                    <li data-translate="host_step_1">Click 'Host a Game'</li>
                                    <li data-translate="host_step_2">Create questions or use AI Generator</li>
                                    <li data-translate="host_step_3">Share the Game PIN with players</li>
                                    <li data-translate="host_step_4">Start the game when ready</li>
                                </ol>
                            </div>
                        </div>
                        
                        <!-- Slide 3: Key Features -->
                        <div class="carousel-slide" data-slide="2">
                            <div class="slide-visual">
                                <div class="slide-icon">âœ¨</div>
                                <div class="slide-bg-pattern features-pattern"></div>
                            </div>
                            <div class="slide-content">
                                <h4 data-translate="features_title">Key Features:</h4>
                                <div class="features-grid">
                                    <span class="feature-item">ğŸ¤– <span data-translate="feature_ai">AI question generation</span></span>
                                    <span class="feature-item">âš¡ <span data-translate="feature_realtime">Real-time multiplayer</span></span>
                                    <span class="feature-item">ğŸ“ <span data-translate="feature_math">LaTeX math support</span></span>
                                    <span class="feature-item">ğŸ–¼ï¸ <span data-translate="feature_images">Image questions</span></span>
                                    <span class="feature-item">ğŸŒ <span data-translate="feature_multilang">Multi-language support</span></span>
                                    <span class="feature-item">ğŸ“ <span data-translate="feature_types">Multiple question types</span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Carousel navigation with arrows and dots -->
                    <div class="carousel-navigation-container">
                        <button class="carousel-nav prev" id="quickstart-carousel-prev" data-translate-aria-label="previous">â€¹</button>
                        <div class="carousel-dots">
                            <button class="carousel-dot active" data-slide="0" data-translate-aria-label="go_to_slide_1"></button>
                            <button class="carousel-dot" data-slide="1" data-translate-aria-label="go_to_slide_2"></button>
                            <button class="carousel-dot" data-slide="2" data-translate-aria-label="go_to_slide_3"></button>
                        </div>
                        <button class="carousel-nav next" id="quickstart-carousel-next" data-translate-aria-label="next">â€º</button>
                    </div>
                </div>
            </div>
            
            <!-- Mobile-Only Question Preview Showcase -->
            <div class="mobile-preview-showcase mobile-only">
                <div class="preview-showcase-header">
                    <h3 data-translate="see_it_in_action">âœ¨ See it in Action</h3>
                    <p data-translate="preview_description">Experience interactive questions with math equations, images, and multiple choice options</p>
                </div>
                <div class="preview-showcase-content">
                    <div class="preview-carousel-container">
                        <div class="preview-carousel" id="preview-carousel">
                            <div class="preview-phone-frame active" data-index="0">
                                <div class="preview-screen">
                                    <img src="images/carrousel-main-menu-mobile-1.png" alt="Quiz sample 1" class="preview-screenshot">
                                </div>
                            </div>
                            <div class="preview-phone-frame" data-index="1">
                                <div class="preview-screen">
                                    <img src="images/carrousel-main-menu-mobile-2.png" alt="Quiz sample 2" class="preview-screenshot">
                                </div>
                            </div>
                            <div class="preview-phone-frame" data-index="2">
                                <div class="preview-screen">
                                    <img src="images/carrousel-main-menu-mobile-3.png" alt="Quiz sample 3" class="preview-screenshot">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Carousel Navigation -->
                        <div class="preview-carousel-navigation">
                            <button class="preview-carousel-nav prev" id="preview-carousel-prev" data-translate-aria-label="previous">â€¹</button>
                            <div class="preview-carousel-dots" id="preview-carousel-dots">
                                <button class="preview-carousel-dot active" data-index="0" data-translate-aria-label="go_to_slide_1"></button>
                                <button class="preview-carousel-dot" data-index="1" data-translate-aria-label="go_to_slide_2"></button>
                                <button class="preview-carousel-dot" data-index="2" data-translate-aria-label="go_to_slide_3"></button>
                            </div>
                            <button class="preview-carousel-nav next" id="preview-carousel-next" data-translate-aria-label="next">â€º</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile-Only Bottom Controls Section (Airbnb-style) -->
            <div class="mobile-bottom-controls mobile-only">
                <!-- Main Action Buttons -->
                <div class="main-actions">
                    <button id="host-btn-mobile" class="btn primary large-action-btn" data-translate="host_game">Host a Game</button>
                    <button id="join-btn-mobile" class="btn secondary large-action-btn" data-translate="join_game">Join Game</button>
                </div>
            </div>
        </div>

        <div id="host-screen" class="screen">
            <!-- Old vertical toolbar removed - now using horizontal toolbar in header -->
            
            <div class="host-container" id="host-container">
                <div class="quiz-editor-section" id="quiz-editor-section">
                    <h2 data-translate="create_quiz">Create Your Quiz</h2>
                    
                    <div class="quiz-builder">
                    <input type="text" id="quiz-title" placeholder="Quiz Title" class="input-field" data-translate-placeholder="quiz_title">
                    
                    <div class="quiz-settings">
                        <div class="general-options">
                            <label>
                                <input type="checkbox" id="randomize-questions"> <span data-translate="randomize_questions">Randomize question order</span>
                            </label>
                            <label>
                                <input type="checkbox" id="randomize-answers"> <span data-translate="randomize_answers">Randomize answer positions</span>
                            </label>
                            <label>
                                <input type="checkbox" id="use-global-time" onchange="QM('toggleGlobalTime')"> <span data-translate="use_same_time">Use same time for all questions</span>
                            </label>
                            <div id="global-time-container" class="time-setting-container" style="display: none;">
                                <label class="time-input-label">
                                    <span data-translate="global_time_limit">Global time limit (seconds):</span>
                                    <input type="number" id="global-time-limit" min="5" max="300" value="20" class="time-input">
                                </label>
                            </div>
                        </div>
                        <div class="advanced-options">
                            <label class="manual-advancement-option" style="border: 2px solid #4299e1; border-radius: 8px; padding: 8px; background: rgba(66, 153, 225, 0.1);">
                                <input type="checkbox" id="manual-advancement" checked data-translate-title="manual_advancement_tooltip"> <strong>ğŸ® <span data-translate="manual_advancement">Manual question advancement (host control)</span></strong>
                            </label>
                        </div>
                        
                        <div class="preview-settings">
                        </div>
                    </div>
                    
                    <div id="questions-container">
                        <div class="question-item" data-question="0">
                            <h3><span data-translate="question">Question</span> 1</h3>
                            
                            <div class="question-meta">
                                <select class="question-type" onchange="updateQuestionType(this)">
                                    <option value="multiple-choice" data-translate="multiple_choice">Multiple Choice</option>
                                    <option value="multiple-correct" data-translate="multiple_correct">Multiple Correct Answers</option>
                                    <option value="true-false" data-translate="true_false">True/False</option>
                                    <option value="numeric" data-translate="numeric_answer">Numeric Answer</option>
                                    <option value="ordering" data-translate="ordering">Ordering</option>
                                </select>
                                
                                <select class="question-difficulty">
                                    <option value="easy" data-translate="easy">Easy (100 pts)</option>
                                    <option value="medium" selected data-translate="medium">Medium (200 pts)</option>
                                    <option value="hard" data-translate="hard">Hard (300 pts)</option>
                                </select>
                                
                                <div class="time-limit-container">
                                    <label>
                                        <span data-translate="time_seconds">Time (sec):</span>
                                        <input type="number" class="question-time-limit" min="5" max="300" value="20" onchange="updateTimeLimit(this)">
                                    </label>
                                </div>
                            </div>
                            
                            <div class="question-content">
                                <textarea class="question-text" placeholder="Enter your question (supports LaTeX: $x^2 + y^2 = z^2$)" data-translate-placeholder="enter_question"></textarea>
                                
                                <div class="image-upload">
                                    <label data-translate="add_image">Add Image (optional):</label>
                                    <input type="file" class="image-input" accept="image/*" onchange="uploadImage(this)">
                                    <div class="image-preview" style="display: none;">
                                        <img class="question-image" src="" alt="Question Image" style="max-width: 200px; max-height: 150px;">
                                        <button type="button" class="remove-image" onclick="removeImage(this)" data-translate="remove_image">Remove</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="answer-options multiple-choice-options">
                                <div class="options">
                                    <input type="text" class="option" data-option="0" placeholder="Option A" data-translate-placeholder="option_a">
                                    <input type="text" class="option" data-option="1" placeholder="Option B" data-translate-placeholder="option_b">
                                    <input type="text" class="option" data-option="2" placeholder="Option C" data-translate-placeholder="option_c">
                                    <input type="text" class="option" data-option="3" placeholder="Option D" data-translate-placeholder="option_d">
                                </div>
                                <select class="correct-answer">
                                    <option value="0" data-translate="a_is_correct">A is correct</option>
                                    <option value="1" data-translate="b_is_correct">B is correct</option>
                                    <option value="2" data-translate="c_is_correct">C is correct</option>
                                    <option value="3" data-translate="d_is_correct">D is correct</option>
                                </select>
                            </div>
                            
                            <div class="answer-options multiple-correct-options" style="display: none;">
                                <div class="options-checkboxes">
                                    <label><input type="checkbox" class="correct-option" data-option="0"> <input type="text" class="option" placeholder="Option A" data-translate-placeholder="option_a"></label>
                                    <label><input type="checkbox" class="correct-option" data-option="1"> <input type="text" class="option" placeholder="Option B" data-translate-placeholder="option_b"></label>
                                    <label><input type="checkbox" class="correct-option" data-option="2"> <input type="text" class="option" placeholder="Option C" data-translate-placeholder="option_c"></label>
                                    <label><input type="checkbox" class="correct-option" data-option="3"> <input type="text" class="option" placeholder="Option D" data-translate-placeholder="option_d"></label>
                                </div>
                            </div>
                            
                            <div class="answer-options true-false-options" style="display: none;">
                                <select class="correct-answer">
                                    <option value="true" data-translate="true">True</option>
                                    <option value="false" data-translate="false">False</option>
                                </select>
                            </div>
                            
                            <div class="answer-options numeric-options" style="display: none;">
                                <label data-translate="correct_answer">Correct Answer:</label>
                                <input type="number" class="numeric-answer" placeholder="Enter numeric answer" step="any" data-translate-placeholder="enter_numeric_answer">
                                <label data-translate="tolerance">Tolerance (+/-):</label>
                                <input type="number" class="numeric-tolerance" placeholder="0.1" step="any" value="0.1">
                            </div>

                            <div class="answer-options ordering-options" style="display: none;">
                                <div class="ordering-instruction" data-translate="ordering_instruction">Enter items in the correct order (top to bottom):</div>
                                <div class="ordering-items">
                                    <div class="ordering-item" data-order="0">
                                        <span class="ordering-handle">â˜°</span>
                                        <input type="text" class="ordering-option" data-option="0" placeholder="First item" data-translate-placeholder="ordering_item_1">
                                        <span class="ordering-number">1</span>
                                    </div>
                                    <div class="ordering-item" data-order="1">
                                        <span class="ordering-handle">â˜°</span>
                                        <input type="text" class="ordering-option" data-option="1" placeholder="Second item" data-translate-placeholder="ordering_item_2">
                                        <span class="ordering-number">2</span>
                                    </div>
                                    <div class="ordering-item" data-order="2">
                                        <span class="ordering-handle">â˜°</span>
                                        <input type="text" class="ordering-option" data-option="2" placeholder="Third item" data-translate-placeholder="ordering_item_3">
                                        <span class="ordering-number">3</span>
                                    </div>
                                    <div class="ordering-item" data-order="3">
                                        <span class="ordering-handle">â˜°</span>
                                        <input type="text" class="ordering-option" data-option="3" placeholder="Fourth item" data-translate-placeholder="ordering_item_4">
                                        <span class="ordering-number">4</span>
                                    </div>
                                </div>
                            </div>

                            <div class="explanation-section">
                                <details>
                                    <summary data-translate="explanation_optional">Explanation (optional)</summary>
                                    <textarea class="question-explanation" placeholder="Explain why the correct answer is correct..." data-translate-placeholder="explanation_placeholder"></textarea>
                                </details>
                            </div>
                        </div>
                    </div>
                    
                    
                    <input type="file" id="import-file-input" accept=".csv,.json" style="display: none;">
                    
                    <!-- Back to Top Button -->
                    <button id="back-to-top" class="back-to-top-btn" onclick="scrollToTop()" style="display: none;" title="Back to Top">
                        â¬†ï¸
                    </button>
                    </div>
                </div>
                
                <!-- Resizable Split Divider -->
                <div class="split-resize-handle" id="split-resize-handle" style="display: none;">
                    <div class="resize-grip">
                        <div class="grip-dot"></div>
                        <div class="grip-dot"></div>
                        <div class="grip-dot"></div>
                    </div>
                </div>
                
                <!-- Live Preview Section -->
                <div class="quiz-preview-section" id="quiz-preview-section" style="display: none;">
                    <div class="preview-header">
                        <h4 data-translate="live_preview">Live Preview</h4>
                        <div class="preview-header-controls">
                            <button id="toggle-preview" class="btn secondary" onclick="togglePreviewMode()" data-translate="close_live_preview">Close Live Preview</button>
                        </div>
                    </div>
                    
                    <div class="preview-navigation-bar">
                        <div class="preview-nav-section">
                            <button id="preview-prev-split" class="nav-btn">â—€</button>
                            <button id="preview-next-split" class="nav-btn">â–¶</button>
                        </div>
                        <span id="preview-question-counter-split">Q1/1</span>
                        <div class="preview-nav-section">
                            <button id="scroll-to-question" class="nav-btn edit-btn" onclick="scrollToCurrentQuestion()"><span data-translate="edit_question">Edit Question</span></button>
                        </div>
                    </div>
                    
                    <div id="preview-viewport-split" class="preview-viewport-split desktop-viewport">
                        <div id="preview-content-split" class="preview-content-split">
                            <div class="player-question-area">
                                <div id="preview-question-counter-display-split"><span data-translate="question">Question</span> 1 <span data-translate="of">of</span> 1</div>
                                <div id="preview-question-text-split" data-translate="select_question_preview">Select a question to preview</div>
                                <div id="preview-question-image-split" style="display: none;">
                                    <img id="preview-question-img-split" src="" alt="Question Image">
                                </div>
                            </div>
                            
                            <div id="preview-answer-area-split">
                                <!-- Multiple Choice Preview -->
                                <div id="preview-multiple-choice-split" class="preview-answer-type" style="display: none;">
                                    <div class="player-options">
                                        <div class="player-option preview-option" data-option="0">A: Option 1</div>
                                        <div class="player-option preview-option" data-option="1">B: Option 2</div>
                                        <div class="player-option preview-option" data-option="2">C: Option 3</div>
                                        <div class="player-option preview-option" data-option="3">D: Option 4</div>
                                    </div>
                                </div>
                                
                                <!-- Multiple Correct Preview -->
                                <div id="preview-multiple-correct-split" class="preview-answer-type" style="display: none;">
                                    <div class="player-checkbox-options">
                                        <div class="checkbox-option preview-checkbox" data-option="0">
                                            <input type="checkbox" disabled> A: Option 1
                                        </div>
                                        <div class="checkbox-option preview-checkbox" data-option="1">
                                            <input type="checkbox" disabled> B: Option 2
                                        </div>
                                        <div class="checkbox-option preview-checkbox" data-option="2">
                                            <input type="checkbox" disabled> C: Option 3
                                        </div>
                                        <div class="checkbox-option preview-checkbox" data-option="3">
                                            <input type="checkbox" disabled> D: Option 4</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- True/False Preview -->
                                <div id="preview-true-false-split" class="preview-answer-type" style="display: none;">
                                    <div class="true-false-options">
                                        <div class="tf-option preview-tf" data-option="true" data-translate="true">True</div>
                                        <div class="tf-option preview-tf" data-option="false" data-translate="false">False</div>
                                    </div>
                                </div>
                                
                                <!-- Numeric Preview -->
                                <div id="preview-numeric-split" class="preview-answer-type" style="display: none;">
                                    <div class="numeric-input-container">
                                        <input type="number" id="preview-numeric-input-split" placeholder="Enter your answer" disabled data-translate-placeholder="enter_answer">
                                        <button class="btn primary" disabled data-translate="submit">Submit</button>
                                    </div>
                                </div>

                                <!-- Ordering Preview -->
                                <div id="preview-ordering-split" class="preview-answer-type" style="display: none;">
                                    <!-- Ordering options will be dynamically rendered here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Floating Back to Top Button -->
            <button id="back-to-top-float" class="back-to-top-float" onclick="scrollToTop()" style="display: none;">
                â¬†ï¸
            </button>
            
            <!-- Mobile Quiz Management FAB -->
            <button id="mobile-quiz-fab" class="mobile-quiz-fab" onclick="showMobileQuizSheet()" aria-label="Editing Tools">
                ğŸ”§ <span data-translate="tools">Tools</span>
            </button>
            
        </div>

        <!-- Preview Modal Overlay -->
        <div id="preview-modal-overlay" class="modal-overlay" style="display: none;">
            <div id="preview-modal" class="preview-modal">
                <div class="preview-modal-header">
                    <div class="preview-title-section">
                        <h2>ğŸ“± <span data-translate="question_preview">Question Preview</span></h2>
                    </div>
                    <button id="close-preview" class="close-btn" onclick="closePreviewModal()">Ã—</button>
                </div>
                
                <div class="preview-navigation-bar">
                    <div class="preview-nav-section">
                        <button id="preview-prev" class="nav-btn">â—€ <span data-translate="previous">Previous</span></button>
                        <button id="preview-next" class="nav-btn"><span data-translate="next">Next</span> â–¶</button>
                    </div>
                    <span id="preview-question-counter"><span data-translate="question">Question</span> 1 <span data-translate="of">of</span> 1</span>
                    <button id="edit-current-question" class="nav-btn edit-btn"><span data-translate="edit_question">Edit Question</span></button>
                </div>
                
                <div id="preview-viewport" class="preview-viewport desktop-viewport">
                    <div id="preview-content" class="preview-content">
                        <div class="player-question-area">
                            <div id="preview-question-counter-display"><span data-translate="question">Question</span> 1 <span data-translate="of">of</span> 1</div>
                            <div id="preview-question-text" data-translate="select_question_preview">Select a question to preview</div>
                            <div id="preview-question-image" style="display: none;">
                                <img id="preview-question-img" src="" alt="Question Image">
                            </div>
                        </div>
                        
                        <div id="preview-answer-area">
                            <!-- Multiple Choice Preview -->
                            <div id="preview-multiple-choice" class="preview-answer-type" style="display: none;">
                                <div class="player-options">
                                    <div class="player-option preview-option" data-option="0">A: Option 1</div>
                                    <div class="player-option preview-option" data-option="1">B: Option 2</div>
                                    <div class="player-option preview-option" data-option="2">C: Option 3</div>
                                    <div class="player-option preview-option" data-option="3">D: Option 4</div>
                                </div>
                            </div>
                            
                            <!-- Multiple Correct Preview -->
                            <div id="preview-multiple-correct" class="preview-answer-type" style="display: none;">
                                <div class="player-checkbox-options">
                                    <div class="checkbox-option preview-checkbox" data-option="0">
                                        <input type="checkbox" disabled> A: Option 1
                                    </div>
                                    <div class="checkbox-option preview-checkbox" data-option="1">
                                        <input type="checkbox" disabled> B: Option 2
                                    </div>
                                    <div class="checkbox-option preview-checkbox" data-option="2">
                                        <input type="checkbox" disabled> C: Option 3
                                    </div>
                                    <div class="checkbox-option preview-checkbox" data-option="3">
                                        <input type="checkbox" disabled> D: Option 4
                                    </div>
                                </div>
                            </div>
                            
                            <!-- True/False Preview -->
                            <div id="preview-true-false" class="preview-answer-type" style="display: none;">
                                <div class="true-false-options">
                                    <div class="tf-option preview-tf" data-option="true" data-translate="true">True</div>
                                    <div class="tf-option preview-tf" data-option="false" data-translate="false">False</div>
                                </div>
                            </div>
                            
                            <!-- Numeric Preview -->
                            <div id="preview-numeric" class="preview-answer-type" style="display: none;">
                                <div class="numeric-input-container">
                                    <input type="number" id="preview-numeric-input" placeholder="Enter your answer" disabled data-translate-placeholder="enter_answer">
                                    <button class="btn primary" disabled data-translate="submit">Submit</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="game-lobby" class="screen">
            <div class="lobby-container">
                <!-- New 2-Column Layout -->
                <div class="lobby-layout">
                    <!-- Left Column: Players List -->
                    <div class="lobby-column left-column">
                        <div class="lobby-card players-list-card" role="region" aria-label="Connected Players">
                            <div class="card-header">
                                <h3 class="card-title" data-translate="players_joined">Players Joined</h3>
                            </div>
                            <div class="card-content">
                                <div id="players-list" class="players-grid"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Combined Game Info with QR, PIN, Player Count, and Start Button -->
                    <div class="lobby-column right-column">
                        <div class="lobby-card combined-info-card" role="region" aria-label="Game Information and Controls">
                            <div class="card-header">
                                <h3 class="card-title" data-translate="game_info">Game Info</h3>
                            </div>
                            <div class="card-content combined-content">
                                <!-- QR Code and PIN Section -->
                                <div class="qr-pin-section">
                                    <div id="qr-code-container" class="qr-container">
                                        <div class="qr-loading" data-translate="generating_qr">Generating QR Code...</div>
                                        <img id="qr-code-image" style="display: none;" alt="QR Code to join game">
                                    </div>
                                    <div class="pin-section">
                                        <div id="game-pin" class="pin-display" role="button" tabindex="0" aria-label="Click to copy PIN">
                                            <div class="pin-text" data-translate="game_pin">Game PIN</div>
                                            <div class="pin-digits">------</div>
                                        </div>
                                        <p id="game-url" class="game-url"></p>
                                    </div>
                                </div>
                                
                                <!-- Start Game Section with Player Count -->
                                <div class="action-section">
                                    <div class="player-count-display">
                                        <span class="player-icon">ğŸ‘¥</span>
                                        <span id="lobby-player-count" class="player-count-number">0</span>
                                        <span class="info-label" data-translate="players">players</span>
                                    </div>
                                    <button id="start-game" class="btn primary large-start-btn" aria-label="Start the quiz game">
                                        <span data-translate="start_game">Start Game</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quiz Name at Bottom -->
                <div class="quiz-name-section">
                    <h2 id="lobby-quiz-title" class="quiz-title-display" data-translate="quiz_title">Quiz Title</h2>
                </div>
            </div>
        </div>

        <div id="host-game-screen" class="screen">
            <div class="host-game-container">
                <!-- Host-specific header with timer and counter -->
                <div class="question-header">
                    <span id="question-counter">Question 1 of 5</span>
                    <div id="timer" class="timer">20</div>
                </div>
                
                <!-- Use client-style question display -->
                <div id="host-question-display" class="player-question-area">
                    <div id="question-image-display" class="question-image-container" style="display: none;">
                        <img id="host-question-image" src="" alt="Question Image">
                    </div>
                    <h3 id="current-question" data-translate="question_will_appear_here">Question will appear here</h3>
                </div>
                
                    <!-- Real-time Answer Statistics -->
                    <!-- Moved above alternatives for better host visibility -->
                    <div id="answer-statistics" class="answer-stats" style="display: none;">
                        <div class="stats-header">
                            <h3 data-translate="live_answer_statistics">Live Answer Statistics</h3>
                            <!-- Game control buttons for statistics phase - moved to top for visibility -->
                            <div class="stats-controls" id="game-controls" style="display: none;">
                                <button id="next-question-stats" class="btn primary" style="display: none;" data-translate="next_question">Next Question</button>
                                <button id="exit-to-main-stats" class="btn secondary" data-translate="exit_to_main">Exit to Main Menu</button>
                            </div>
                        </div>
                        <div class="stats-grid" id="stats-grid">
                            <div class="stat-item" id="stat-item-0">
                                <div class="option-label">A</div>
                                <div class="stat-bar">
                                    <div class="stat-fill" id="stat-fill-0" style="width: 0%"></div>
                                </div>
                                <div class="stat-count" id="stat-count-0">0</div>
                            </div>
                            <div class="stat-item" id="stat-item-1">
                                <div class="option-label">B</div>
                                <div class="stat-bar">
                                    <div class="stat-fill" id="stat-fill-1" style="width: 0%"></div>
                                </div>
                                <div class="stat-count" id="stat-count-1">0</div>
                            </div>
                            <div class="stat-item" id="stat-item-2">
                                <div class="option-label">C</div>
                                <div class="stat-bar">
                                    <div class="stat-fill" id="stat-fill-2" style="width: 0%"></div>
                                </div>
                                <div class="stat-count" id="stat-count-2">0</div>
                            </div>
                            <div class="stat-item" id="stat-item-3">
                                <div class="option-label">D</div>
                                <div class="stat-bar">
                                    <div class="stat-fill" id="stat-fill-3" style="width: 0%"></div>
                                </div>
                                <div class="stat-count" id="stat-count-3">0</div>
                            </div>
                            <div class="stat-item" id="stat-item-4" style="display: none;">
                                <div class="option-label">E</div>
                                <div class="stat-bar">
                                    <div class="stat-fill" id="stat-fill-4" style="width: 0%"></div>
                                </div>
                                <div class="stat-count" id="stat-count-4">0</div>
                            </div>
                            <div class="stat-item" id="stat-item-5" style="display: none;">
                                <div class="option-label">F</div>
                                <div class="stat-bar">
                                    <div class="stat-fill" id="stat-fill-5" style="width: 0%"></div>
                                </div>
                                <div class="stat-count" id="stat-count-5">0</div>
                            </div>
                        </div>
                        <div class="response-summary" id="response-summary">
                            <span id="responses-count">0</span> <span data-translate="of">of</span> <span id="total-players">0</span> <span data-translate="players_have_answered">players have answered</span>
                        </div>
                    </div>
                
                <!-- Use client-style options -->
                <!-- Moved below statistics for better information hierarchy -->
                <div id="host-multiple-choice" class="player-answer-type">
                    <div class="question-alternatives-header" data-translate="question_alternatives">Question Alternatives</div>
                    <div id="answer-options" class="player-options">
                        <div class="player-option" data-option="0">A</div>
                        <div class="player-option" data-option="1">B</div>
                        <div class="player-option" data-option="2">C</div>
                        <div class="player-option" data-option="3">D</div>
                    </div>
                </div>
                </div>
            </div>
        </div>

        <div id="join-screen" class="screen">
            <div class="join-container">
                <h2 data-translate="join_game">Join Game</h2>
                <input type="text" id="game-pin-input" placeholder="Enter Game PIN" class="input-field" data-translate-placeholder="enter_game_pin">
                <input type="text" id="player-name" placeholder="Your Name" class="input-field" data-translate-placeholder="your_name">
                <button id="join-game" class="btn primary" data-translate="join_game">Join Game</button>
                
                <div class="join-divider">
                    <span data-translate="or">OR</span>
                </div>
                
                <button id="browse-games" class="btn secondary">ğŸ” <span data-translate="browse_games">Browse Available Games</span></button>
                
                <div class="join-actions">
                    <button id="return-to-main" class="btn secondary return-btn">ğŸ  <span data-translate="return_to_main">Return to Main Menu</span></button>
                </div>
            </div>
        </div>
        
        <div id="game-browser" class="screen">
            <div class="browser-container">
                <h2 data-translate="available_games">Available Games</h2>
                <div class="browser-actions">
                    <button id="refresh-games" class="btn secondary">ğŸ”„ <span data-translate="refresh">Refresh</span></button>
                    <button id="back-to-join" class="btn secondary">â† <span data-translate="back_to_join">Back to Join</span></button>
                </div>
                <div id="games-list" class="games-grid">
                    <div class="loading-games" data-translate="loading_games">Loading games...</div>
                </div>
            </div>
        </div>

        <div id="player-lobby" class="screen">
            <div class="player-lobby-container">
                <h2 data-translate="waiting_for_game">Waiting for game to start...</h2>
                <p id="player-info" data-translate="you_are_in">You're in!</p>
                
                <div class="lobby-info" id="lobby-info" style="display: none;">
                    <div class="lobby-detail">
                        <span class="lobby-detail-label">
                            <span>ğŸ¯</span>
                            <span data-translate="game_pin">Game PIN</span>
                        </span>
                        <span class="lobby-detail-value" id="lobby-pin-display">------</span>
                    </div>
                    <div class="lobby-detail">
                        <span class="lobby-detail-label">
                            <span>ğŸ‘¥</span>
                            <span data-translate="players_joined">Players</span>
                        </span>
                        <span class="lobby-detail-value" id="lobby-player-count">1</span>
                    </div>
                </div>
                
                <div class="lobby-status">
                    <span data-translate="connected_waiting">Connected - Waiting for host</span>
                </div>
                
                <div class="loading-animation">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            </div>
        </div>

        <div id="player-game-screen" class="screen">
            <div class="player-game-container">
                <div class="question-info">
                    <span id="player-question-counter">Question 1 of 5</span>
                </div>
                
                <div id="player-question-display" class="player-question-area">
                    <div id="player-question-image" class="question-image-container" style="display: none;">
                        <img id="player-question-img" src="" alt="Question Image">
                    </div>
                    <h3 id="player-question-text" data-translate="question_will_appear_here">Question will appear here</h3>
                </div>
                
                <div id="player-multiple-choice" class="player-answer-type">
                    <div class="player-options">
                        <button class="player-option" data-option="0">A</button>
                        <button class="player-option" data-option="1">B</button>
                        <button class="player-option" data-option="2">C</button>
                        <button class="player-option" data-option="3">D</button>
                    </div>
                </div>
                
                <div id="player-multiple-correct" class="player-answer-type" style="display: none;">
                    <div class="player-checkbox-options">
                        <label class="checkbox-option" data-option="0">
                            <input type="checkbox" class="option-checkbox"> A
                        </label>
                        <label class="checkbox-option" data-option="1">
                            <input type="checkbox" class="option-checkbox"> B
                        </label>
                        <label class="checkbox-option" data-option="2">
                            <input type="checkbox" class="option-checkbox"> C
                        </label>
                        <label class="checkbox-option" data-option="3">
                            <input type="checkbox" class="option-checkbox"> D
                        </label>
                    </div>
                    <button id="submit-multiple" class="btn primary" data-translate="submit_answer">Submit Answer</button>
                </div>
                
                <div id="player-true-false" class="player-answer-type" style="display: none;">
                    <div class="true-false-options">
                        <button class="tf-option" data-answer="true" data-translate="true">TRUE</button>
                        <button class="tf-option" data-answer="false" data-translate="false">FALSE</button>
                    </div>
                </div>
                
                <div id="player-numeric" class="player-answer-type" style="display: none;">
                    <div class="numeric-input-container">
                        <input type="number" id="numeric-answer-input" placeholder="Enter your answer" step="any" data-translate-placeholder="enter_answer">
                        <button id="submit-numeric" class="btn primary" data-translate="submit_answer">Submit Answer</button>
                    </div>
                </div>

                <div id="player-ordering" class="player-answer-type" style="display: none;">
                    <div class="ordering-container">
                        <!-- Ordering options will be dynamically generated here -->
                    </div>
                </div>

                <!-- Legacy inline feedback (kept for compatibility) -->
                <div id="answer-feedback" class="feedback hidden">
                    <div id="feedback-message"></div>
                    <div id="score-display"></div>
                </div>
            </div>
        </div>

        <div id="leaderboard-screen" class="screen">
            <div class="leaderboard-container">
                <div class="leaderboard-header">
                    <h2 data-translate="leaderboard_title">ğŸ† Leaderboard</h2>
                    <div class="leaderboard-controls">
                        <button id="next-question" class="btn primary" style="display: none;" data-translate="next_question">Next Question</button>
                    </div>
                </div>
                <div id="leaderboard-list" class="leaderboard"></div>
                <div id="final-results" class="final-results hidden">
                    <h3 data-translate="game_complete">ğŸ‰ Game Complete!</h3>
                    <div class="final-actions">
                        <div class="download-results" style="display: none;">
                            <label for="results-dropdown" data-translate="download_results">Download Results:</label>
                            <select id="results-dropdown" class="input-field">
                                <option value="" data-translate="select_results">Select results to download...</option>
                            </select>
                            <button id="download-selected" class="btn secondary" data-translate="download_csv">Download CSV</button>
                        </div>
                        <button id="new-game" class="btn primary" data-translate="new_game">New Game</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="player-final-screen" class="screen">
            <div class="player-final-container">
                <h2 data-translate="quiz_complete">ğŸ‰ Quiz Complete!</h2>
                <div id="player-final-rank" class="player-rank">
                    <h3 data-translate="your_final_rank">Your Final Rank</h3>
                    <div id="final-position" class="final-position">#1</div>
                    <div id="final-score" class="final-score">0 <span data-translate="points">points</span></div>
                </div>
                <div id="top-players" class="top-players">
                    <h3 data-translate="top_players">ğŸ† Top Players</h3>
                    <div id="final-leaderboard" class="final-leaderboard"></div>
                </div>
                <button id="play-again" class="btn primary" data-translate="play_again">Play Again</button>
            </div>
        </div>
        
        <!-- Load Quiz Modal -->
        <div id="load-quiz-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h3 data-translate="load_saved_quiz">Load Saved Quiz</h3>
                <div id="quiz-list" class="quiz-list"></div>
                <div class="modal-actions">
                    <button id="cancel-load" class="btn secondary" data-translate="cancel">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- Quiz Preview Modal -->
        <div id="quiz-preview-modal" class="modal" style="display: none;">
            <div class="modal-content large">
                <h3 data-translate="preview_quiz">Quiz Preview</h3>
                <div id="preview-content" class="preview-content"></div>
                <div class="modal-actions">
                    <button id="cancel-preview" class="btn secondary" data-translate="close">Close</button>
                </div>
            </div>
        </div>
        

        <!-- AI Question Generator Modal -->
        <div id="ai-generator-modal" class="modal" style="display: none;">
            <div class="modal-content large">
                <div class="modal-header">
                    <h3>ğŸ¤– <span data-translate="ai_generator">AI Question Generator</span></h3>
                    <button id="close-ai-generator" class="close-btn">&times;</button>
                </div>
                
                <div class="ai-config-section">
                    <div class="provider-selection">
                        <label for="ai-provider" data-translate="choose_ai_provider">Choose AI Provider:</label>
                        <select id="ai-provider" class="input-field">
                            <option value="ollama" data-translate="ollama_free_local">Ollama (Free, Local)</option>
                            <option value="openai" data-translate="openai_paid">OpenAI (Paid)</option>
                            <option value="claude" data-translate="claude_paid">Anthropic Claude (Paid)</option>
                            <option value="gemini" data-translate="gemini_paid">Google Gemini (Paid)</option>
                        </select>
                    </div>
                    
                    <div class="model-selection" id="model-selection">
                        <label for="ollama-model" data-translate="choose_model">Choose Model:</label>
                        <select id="ollama-model" class="input-field">
                        </select>
                        <small data-translate="select_ollama_model">Select which Ollama model to use for generation</small>
                    </div>

                    <div class="model-selection" id="claude-model-selection" style="display: none;">
                        <label for="claude-model" data-translate="choose_claude_model">Choose Claude Model:</label>
                        <select id="claude-model" class="input-field">
                            <option value="claude-sonnet-4-5">Claude Sonnet 4.5 (Recommended)</option>
                            <option value="claude-haiku-4-5">Claude Haiku 4.5 (Fast & Cheap)</option>
                            <option value="claude-opus-4-5">Claude Opus 4.5 (Most Capable)</option>
                            <option value="claude-sonnet-4-0">Claude Sonnet 4 (Legacy)</option>
                        </select>
                        <small data-translate="select_claude_model">Select which Claude model to use for generation</small>
                    </div>

                    <div class="api-key-section" id="api-key-section" style="display: none;">
                        <label for="ai-api-key" data-translate="api_key">API Key:</label>
                        <input type="password" id="ai-api-key" class="input-field" placeholder="Enter your API key" data-translate-placeholder="enter_api_key_placeholder">
                        <small data-translate="api_key_stored_locally">Your API key is stored locally and never sent to our servers</small>
                    </div>
                </div>
                
                <div class="content-input-section">
                    <label for="source-content" data-translate="source_material">Source Material:</label>
                    <textarea id="source-content" class="input-field" rows="8" placeholder="Paste your text content here, or upload a file below..." data-translate-placeholder="paste_content_here"></textarea>
                    
                    <!-- Content Analysis Summary -->
                    <div class="content-analysis-panel" id="content-analysis-panel" style="display: none;">
                        <div class="analysis-header">
                            <span class="analysis-icon">ğŸ“Š</span>
                            <span data-translate="content_analysis">Content Analysis</span>
                        </div>
                        <div class="analysis-grid">
                            <div class="analysis-item">
                                <span class="analysis-label" data-translate="detected_type">Type:</span>
                                <span class="analysis-value" id="detected-content-type">General</span>
                            </div>
                            <div class="analysis-item">
                                <span class="analysis-label" data-translate="formatting">Formatting:</span>
                                <span class="analysis-value" id="detected-formatting">Standard</span>
                            </div>
                            <div class="analysis-item" id="detected-language-item" style="display: none;">
                                <span class="analysis-label" data-translate="detected_language">Language:</span>
                                <span class="analysis-value" id="detected-language">-</span>
                            </div>
                            <div class="analysis-item">
                                <span class="analysis-label" data-translate="content_mode">Mode:</span>
                                <span class="analysis-value" id="detected-mode">Generate new</span>
                            </div>
                        </div>
                        <div class="analysis-recommendation" id="analysis-recommendation"></div>
                    </div>
                    
                    <div class="file-upload-section">
                        <label for="content-file" data-translate="or_upload_file">Or upload a file:</label>
                        <input type="file" id="content-file" accept=".txt,.pdf,.docx,.md,.xlsx,.xls" class="input-field">
                        <small data-translate="supported_formats">Supported formats: TXT, PDF, DOCX, Markdown, Excel</small>
                    </div>
                </div>
                
                <div class="generation-options">
                    <div class="option-group">
                        <label for="question-count" data-translate="number_of_questions">Number of Questions:</label>
                        <input type="number" id="question-count" value="1" min="1" max="20" class="input-field number-input">
                    </div>
                    
                    <div class="option-group">
                        <label for="difficulty-level" data-translate="difficulty_level">Difficulty Level:</label>
                        <select id="difficulty-level" class="input-field">
                            <option value="mixed" data-translate="mixed">Mixed</option>
                            <option value="easy" data-translate="easy">Easy</option>
                            <option value="medium" data-translate="medium">Medium</option>
                            <option value="hard" data-translate="hard">Hard</option>
                        </select>
                    </div>

                    <div class="option-group">
                        <label for="cognitive-level" data-translate="cognitive_level">Cognitive Level (Bloom's):</label>
                        <select id="cognitive-level" class="input-field">
                            <option value="mixed" data-translate="blooms_mixed">Mixed Levels</option>
                            <option value="remember" data-translate="blooms_remember">Remember (Recall facts)</option>
                            <option value="understand" data-translate="blooms_understand">Understand (Explain concepts)</option>
                            <option value="apply" data-translate="blooms_apply">Apply (Use in new situations)</option>
                            <option value="analyze" data-translate="blooms_analyze">Analyze (Break down, compare)</option>
                            <option value="evaluate" data-translate="blooms_evaluate">Evaluate (Judge, critique)</option>
                            <option value="create" data-translate="blooms_create">Create (Design, construct)</option>
                        </select>
                    </div>
                    
                    <div class="option-group">
                        <label data-translate="question_types">Question Types:</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="type-multiple-choice" checked> <span data-translate="multiple_choice_type">Multiple Choice</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="type-true-false"> <span data-translate="true_false_type">True/False</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="type-multiple-correct"> <span data-translate="multiple_correct_type">Multiple Correct Answers</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="type-numeric"> <span data-translate="numeric_answer_type">Numeric Answer</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="type-ordering"> <span data-translate="ordering_type">Ordering</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Cost Estimation -->
                <div class="cost-estimation" id="cost-estimation" style="display: none;">
                    <div class="cost-info">
                        <span class="cost-icon">ğŸ’°</span>
                        <span class="cost-label" data-translate="estimated_cost">Estimated:</span>
                        <span class="cost-value" id="estimated-cost">~$0.00</span>
                        <span class="cost-tokens" id="estimated-tokens">(~0 tokens)</span>
                    </div>
                </div>

                <div class="generation-status" id="generation-status" style="display: none;">
                    <div class="loading-spinner"></div>
                    <span data-translate="generating_questions">Generating questions...</span>
                </div>

                <div class="language-indicator" id="output-language-indicator">
                    <span class="indicator-icon">ğŸŒ</span>
                    <span data-translate="questions_generated_in">Questions will be generated in:</span>
                    <strong id="output-language-name">English</strong>
                </div>

                <div class="modal-actions">
                    <button id="cancel-ai-generator" class="btn secondary" data-translate="cancel">Cancel</button>
                    <button id="generate-questions" class="btn primary" data-translate="generate_questions_btn">Generate Questions</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Question Preview Modal -->
    <div id="question-preview-modal" class="modal" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>ğŸ“ <span data-translate="preview_generated_questions">Preview Generated Questions</span></h3>
                <button id="close-question-preview" class="close-btn">&times;</button>
            </div>

            <div class="preview-instructions">
                <p data-translate="preview_instructions">Review the generated questions below. Click to select which ones to add to your quiz.</p>
            </div>

            <div class="preview-actions-bar">
                <button id="select-all-questions" class="btn secondary small" data-translate="select_all">Select All</button>
                <button id="deselect-all-questions" class="btn secondary small" data-translate="deselect_all">Deselect All</button>
            </div>

            <div class="question-preview-list" id="question-preview-list">
                <!-- Generated questions will be rendered here -->
            </div>

            <div class="preview-summary" id="preview-summary">
                <span class="preview-summary-text">
                    <span data-translate="selected_questions">Selected:</span>
                    <span class="preview-summary-count" id="selected-count">0</span>
                    <span data-translate="of">of</span>
                    <span id="total-generated-count">0</span>
                    <span data-translate="questions_label">questions</span>
                </span>
            </div>

            <div class="modal-actions">
                <button id="cancel-question-preview" class="btn secondary" data-translate="cancel">Cancel</button>
                <button id="confirm-add-questions" class="btn primary" data-translate="add_selected_questions">Add Selected Questions</button>
            </div>
        </div>
    </div>

    <!-- Results Viewing Modal -->
    <div id="results-viewing-modal" class="modal" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>ğŸ“Š <span data-translate="view_quiz_results">Quiz Results History</span></h3>
                <button id="close-results-viewer" class="close-btn">&times;</button>
            </div>
            
            <div class="results-content">
                <div class="results-summary">
                    <div class="summary-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="total-quizzes">0</span>
                            <span class="stat-label" data-translate="total_quizzes">Total Quizzes</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="total-participants">0</span>
                            <span class="stat-label" data-translate="total_participants">Total Participants</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="avg-score">0%</span>
                            <span class="stat-label" data-translate="avg_score">Average Score</span>
                        </div>
                    </div>
                </div>
                
                <div class="results-filters">
                    <div class="filter-group">
                        <input type="text" id="search-results" class="input-field" placeholder="Search by quiz title..." data-translate-placeholder="search_quiz_title">
                        <select id="sort-results" class="input-field">
                            <option value="date-desc" data-translate="sort_newest_first">Newest First</option>
                            <option value="date-asc" data-translate="sort_oldest_first">Oldest First</option>
                            <option value="title-asc" data-translate="sort_title_az">Title A-Z</option>
                            <option value="participants-desc" data-translate="sort_most_participants">Most Participants</option>
                        </select>
                        <button id="refresh-results" class="btn secondary refresh-btn" data-translate="refresh" title="Refresh results list">
                            â†» Refresh
                        </button>
                    </div>
                </div>
                
                <div class="results-list" id="results-list">
                    <div class="loading-message" id="results-loading">
                        <span>Loading quiz results...</span>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <!-- Actions can be added here if needed in the future -->
            </div>
        </div>
    </div>

    <!-- Results Detail Modal -->
    <div id="result-detail-modal" class="modal" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="result-detail-title" data-translate="quiz_results_detail">Quiz Results Detail</h3>
                <button id="close-result-detail" class="close-btn">&times;</button>
            </div>
            
            <div class="result-detail-content">
                <div class="result-summary-card">
                    <div class="summary-row">
                        <span class="label" data-translate="quiz_title">Quiz Title:</span>
                        <span id="detail-quiz-title">-</span>
                    </div>
                    <div class="summary-row">
                        <span class="label" data-translate="game_pin">Game PIN:</span>
                        <span id="detail-game-pin">-</span>
                    </div>
                    <div class="summary-row">
                        <span class="label" data-translate="date_completed">Date:</span>
                        <span id="detail-date">-</span>
                    </div>
                    <div class="summary-row">
                        <span class="label" data-translate="participants">Participants:</span>
                        <span id="detail-participants">-</span>
                    </div>
                    <div class="summary-row">
                        <span class="label" data-translate="avg_score">Average Score:</span>
                        <span id="detail-avg-score">-</span>
                    </div>
                </div>
                
                <div class="participant-results" id="participant-results">
                    <!-- Participant results will be populated here -->
                </div>
            </div>
            
            <div class="modal-actions">
                <div class="action-group">
                    <button id="download-result-csv" class="btn primary" data-translate="download_csv">ğŸ“¥ Download CSV</button>
                    <button id="delete-result" class="btn danger" data-translate="delete_result">ğŸ—‘ï¸ Delete Result</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Feedback System -->
    <div id="feedback-modal-overlay" class="feedback-modal-overlay">
        <div id="feedback-modal" class="feedback-modal">
            <div class="feedback-message">
                <span class="feedback-icon" id="feedback-icon"></span>
                <span id="modal-feedback-text"></span>
            </div>
            <div class="score-display" id="modal-score-display"></div>
            <div class="modal-explanation" id="modal-explanation"></div>
        </div>
    </div>

    <!-- Mobile Quiz Actions Bottom Sheet -->
    <div id="mobile-quiz-sheet-overlay" class="mobile-quiz-sheet-overlay" onclick="hideMobileQuizSheet()">
        <div id="mobile-quiz-sheet" class="mobile-quiz-sheet" onclick="event.stopPropagation()">
            <div class="mobile-quiz-sheet-header">
                <div class="mobile-quiz-sheet-handle" onclick="hideMobileQuizSheet()"></div>
                <h3 class="mobile-quiz-sheet-title" data-translate="quiz_actions">Quiz Actions</h3>
                <button class="mobile-quiz-sheet-close" onclick="hideMobileQuizSheet()">Ã—</button>
            </div>
            
            <div class="mobile-quiz-sheet-content">
                <!-- Primary Actions -->
                <div class="mobile-quiz-primary-actions">
                    <button class="mobile-quiz-action-btn primary" onclick="handleMobileLoadQuiz()">
                        <div class="mobile-quiz-action-icon">ğŸ“‚</div>
                        <div class="mobile-quiz-action-label" data-translate="load_quiz">Load Quiz</div>
                        <div class="mobile-quiz-action-subtitle" data-translate="open_saved_quiz">Open saved quiz</div>
                    </button>
                    
                    <button class="mobile-quiz-action-btn primary" onclick="handleMobileStartGame()">
                        <div class="mobile-quiz-action-icon">ğŸ¯</div>
                        <div class="mobile-quiz-action-label" data-translate="start_game">Start Game</div>
                        <div class="mobile-quiz-action-subtitle" data-translate="begin_hosting">Begin hosting</div>
                    </button>
                    
                    <button class="mobile-quiz-action-btn" onclick="handleMobileSaveQuiz()">
                        <div class="mobile-quiz-action-icon">ğŸ’¾</div>
                        <div class="mobile-quiz-action-label" data-translate="save_quiz">Save Quiz</div>
                        <div class="mobile-quiz-action-subtitle" data-translate="save_progress">Save progress</div>
                    </button>
                    
                    <button class="mobile-quiz-action-btn" onclick="handleMobilePreview()">
                        <div class="mobile-quiz-action-icon">ğŸ‘ï¸</div>
                        <div class="mobile-quiz-action-label" data-translate="preview">Preview</div>
                        <div class="mobile-quiz-action-subtitle" data-translate="test_questions">Test questions</div>
                    </button>
                </div>
                
                <!-- Secondary Actions -->
                <div class="mobile-quiz-secondary-actions">
                    <div class="mobile-quiz-secondary-title" data-translate="more_options">More Options</div>
                    <div class="mobile-quiz-secondary-grid">
                        <button class="mobile-quiz-secondary-btn" onclick="handleMobileAI()">
                            <div class="mobile-quiz-secondary-icon">ğŸ¤–</div>
                            <div class="mobile-quiz-secondary-label" data-translate="ai_generator">AI Generator</div>
                        </button>
                        
                        <button class="mobile-quiz-secondary-btn" onclick="handleMobileImport()">
                            <div class="mobile-quiz-secondary-icon">ğŸ“¥</div>
                            <div class="mobile-quiz-secondary-label" data-translate="import">Import</div>
                        </button>
                        
                        <button class="mobile-quiz-secondary-btn" onclick="handleMobileExport()">
                            <div class="mobile-quiz-secondary-icon">ğŸ“¤</div>
                            <div class="mobile-quiz-secondary-label" data-translate="export">Export</div>
                        </button>
                        
                        <button class="mobile-quiz-secondary-btn" onclick="handleMobileResults()">
                            <div class="mobile-quiz-secondary-icon">ğŸ“Š</div>
                            <div class="mobile-quiz-secondary-label" data-translate="results">Results</div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Socket.IO CDN for better WSL compatibility - fallback to local if CDN fails -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" 
            crossorigin="anonymous"
            onerror="this.onerror=null; this.src='socket.io/socket.io.js';">
    </script>
    <!-- Modular ES6 Structure -->
<script type="module" src="js/main.js"></script>
</body>
</html>